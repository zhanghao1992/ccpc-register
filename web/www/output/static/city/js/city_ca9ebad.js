function City(t){var i=this;if(i.options=t,i.items=$('<div class="city-is">'),i.items.insertBefore(i.options.cityConObj),i.selects=$('<div class="city-list hide">'),i.selects.html('<div class="city-option"><a class="city-confirm" href="javascript:void(0);">确定</a><div class="city-msg"></div></div>'),i.selects.insertBefore(i.options.addBtnObj),$(document).on("mousedown.city",function(t){i.selects[0].contains(t.target)||i.close()}),i.msg=function(t){$(".city-msg").html(t)},i.delegateNext=function(t){t.next().length&&i.delegateNext(t.next()),t.remove()},i.items.delegate(".city-d","click",function(){return $(this).parent().remove(),i.doTrigger(),!1}),i.close=function(){i.selects.addClass("hide").html('<div class="city-option"><a class="city-confirm" href="javascript:void(0);">确定</a><div class="city-msg"></div></div>')},i.doTrigger=function(){var t="";$.each(i.items.find(".city-i"),function(i,e){0==i?t+=$(e).data("id"):t=t+","+$(e).data("id")}),i.options.inputObj.val(t),$(i).trigger("cityChange",[t])},i.options.location){var e="",s="";$.each(i.options.location,function(t,i){e=e+'<span class="city-i" data-id="'+i.id+'">'+i.txt+'<a class="city-d" href="javascript:void(0);">x</a></span>',0==t?s+=i.id:s=s+","+i.id}),i.items.append(e),i.doTrigger()}i.selects.delegate(".city-confirm","click",function(){if(t.number&&$(".city-list-p .active").length!=t.number)i.msg("请选择");else{i.msg("");var e="";$.each($(".city-list-p .active"),function(t,i){0!=t&&(e+="-"),e+=$(i).html()}),i.items.append('<span class="city-i" data-id="'+$(".city-list-p .active:last").data("id")+'">'+e+'<a class="city-d" href="javascript:void(0);">x</a></span>'),i.items.find(".city-i").length>i.options.limit&&i.items.find(".city-i:first").remove();var s="";$.each(i.items.find(".city-i"),function(t,i){0==t?s+=$(i).data("id"):s=s+","+$(i).data("id")}),$(i).trigger("cityChange",[s]),i.options.inputObj.val(s),i.options.inputObj.parents(".form-sub").find(".form-msg").removeClass("form-msg-w").addClass("hide").html(""),i.options.inputObj.parents(".form-sub").find(".form-txt").removeClass("form-txt-w"),i.options.inputObj.parents(".form-sub").find(".form-msg-m").addClass("hide"),i.close()}return!1}),i.selects.delegate(".city-list-p a","click",function(){var t=this;return $(t).parent().find("a").removeClass("active"),$(t).addClass("active"),i.delegateNext($(t).parent().next()),i.selects.append($('<div class="city-list-line"></div>')),i.options.number&&$(".city-list-p .active").length>=i.options.number?!1:(i.getP({parentCode:$(t).data("id")}),!1)}),i.getP=function(t){return i.options.number&&$(".city-list-p .active").length>=i.options.number?!1:void $.ajax({url:"/common/city?typeCode=city",type:"get",data:t,dataType:"json",cache:!1,success:function(t){i.detail(t)},error:function(){}})},i.detail=function(t){if(!t.response||!t.response.length)return!1;var e='<div class="city-list-p">';$.each(t.response,function(t,i){e=e+'<a href="javascript:void(0);" data-id="'+i.code+'">'+i.value+"</a>"}),e+="</div>";var s=$(e),a=$('<div class="city-list-line"></div>');i.selects.append(s).append(a).removeClass("hide"),1==t.response.length&&(s.find("a").addClass("active"),i.getP({parentCode:s.find("a").data("id")}))},i.options.addBtnObj.click(function(){return i.getP({parentCode:""}),!1})}