function Upload(e){var a=$("#"+e.container);a.addClass("upload").addClass("clearfix");var l=0,i=$("<div>");a.html(i);for(var s=e.inputObj,t=0;$("#uploadAdd"+t).length;)t++;var d=$("<div>"),o=$('<a id="uploadAdd'+t+'" class="upload-add" href="javascript:void(0);">添加文件</a>');this.addObj=o,d.html(o),$('<div class="clearfix">').append(d).append($('<div class="upload-msg">最大支持20MB的附件</div>')).insertBefore(i);var n=this;n.setInput=function(){s.val(n.data.length?JSON.stringify(n.data):"")},n.data=[],n.fileNum=0;var p={runtimes:"html5,flash",browse_button:"uploadAdd"+t,container:d[0],url:e.uploadUrl,flash_swf_url:e.flashUrl,file_data_name:"file",filters:{max_file_size:"20mb",mime_types:[{title:"Image files",extensions:"jpg,png,jpeg"},{title:"Image files",extensions:"PGN,sgf"},{title:"Zip files",extensions:"zip"},{title:"Excel files",extensions:"xls,xlsx"},{title:"Word files",extensions:"docx"},{title:"Pdf files",extensions:"pdf"},{title:"Txt files",extensions:"txt"}]},init:{PostInit:function(){!l&&e.fileArr&&(l=1,$.each(e.fileArr,function(e,a){$('<div class="upload-block fl clearfix"><a href="javascript:void(0);" class="upload-dele">删除</a><span class="upload-icon"></span><div class="upload-info"><div class="upload-name">'+a.fileName+'</div><div class="upload-status"><a target="_blank" href="/common/getFile?fileMD5='+a.fileMD5+'">查看</a></div></div></div>').insertBefore(i)}),n.data=e.fileArr,n.fileNum=n.data.length,n.setInput())},FilesAdded:function(a,l){return n.fileNum==e.limit?(alert("超出限制"),r.removeFile(l[0]),!1):(n.fileNum++,e.paramEleSelect&&(r.settings.multipart_params={},$.each($(e.paramEleSelect),function(e,a){"radio"==$(a).prop("type")?$(a).prop("checked")&&(r.settings.multipart_params[$(a).prop("name")]=$(a).val()):"checkbox"==$(a).prop("type")?$(a).prop("checked")&&(r.settings.multipart_params[$(a).prop("name")]=$(a).val()):r.settings.multipart_params[$(a).prop("name")]=$(a).val()})),$('<div class="upload-block fl clearfix"><a href="javascript:void(0);" class="upload-dele">删除</a><span class="upload-icon"></span><div class="upload-info"><div class="upload-name">'+l[0].name+'</div><div class="upload-status"><div class="upload-percent-box"><div class="upload-percent"></div></div><div class="upload-percent-txt">0%</div></div></div></div>').insertBefore(i),void r.start())},UploadProgress:function(e,l){a.find(".upload-percent").css({width:l.percent+"%"}),a.find(".upload-percent-txt").html(l.percent+"%")},FileUploaded:function(l,s,t){var d=JSON.parse(t.response);return 0!=d.code?(alert("上传出错"),a.find(".upload-block:last").remove(),void n.fileNum--):(n.data.push({fileName:d.response.fileName,fileMD5:d.response.fileMD5}),n.setInput(),o.parents(".form-sub").find(".form-msg").removeClass("form-txt-w").addClass("hide").html(""),a.find(".upload-block:last").remove(),$('<div class="upload-block fl clearfix"><a href="javascript:void(0);" class="upload-dele">删除</a><span class="upload-icon"></span><div class="upload-info"><div class="upload-name">'+d.response.fileName+'</div><div class="upload-status"><a target="_blank" href="/common/getFile?fileMD5='+d.response.fileMD5+'">查看</a><span style="margin-left: 30px;display: inline-block;color:#008000">上传成功</span></div></div></div>').insertBefore(i),void(e.callback&&e.callback({fileName:d.response.fileName,fileMD5:d.response.fileMD5})))},UploadComplete:function(){},Error:function(e,a){alert(-600==a.code?"请上传小于20MB的文件":a.message)}}};e.file_type&&"excel"==e.file_type&&(p.filters.mime_types=[{title:"Excel files",extensions:"xls,xlsx"}]),e.param&&(p.url+=$.param(e.param));var r=new plupload.Uploader(p);r.init(),n.clear=function(){s.val(""),a.find(".upload-block").remove()},a.delegate(".upload-dele","click",function(){var e=this,l=a.find(".upload-dele").index(e);return a.find(".upload-block:eq("+l+")").remove(),n.data.splice(l,1),n.fileNum--,n.setInput(),!1})}